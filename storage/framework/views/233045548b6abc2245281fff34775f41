<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="Keywords" content="<?php echo e(shopConfig('shop_keywords')); ?>"/>
    <meta name="Description" content="<?php echo e(shopConfig('shop_desc')); ?>"/>
    <meta name="_token" content="<?php echo e(csrf_token()); ?>"/>
    <title>密码找回-<?php echo e(shopConfig('shop_title')); ?></title>
    <link rel="shortcut icon" href="<?php echo e(path('images/favicon.ico')); ?>"/>
    <link rel="icon" href="<?php echo e(path('images/animated_favicon.gif')); ?>" type="image/gif"/>
    <link href="<?php echo e(path('css/base.css')); ?>" rel="stylesheet" type="text/css"/>
    <link href="<?php echo e(path('css/login.css')); ?>" rel="stylesheet" type="text/css"/>
    <link href="<?php echo e(path('css/log_reg_com.css')); ?>" rel="stylesheet" type="text/css"/>
    <link href="<?php echo e(path('css/retrieve_psw.css')); ?>" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="<?php echo e(path('js/jquery.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('layer/layer.js')); ?>"></script>
    <style type="text/css">
        .username_1 {
            margin-left: 10px !important;
        }

        label p {
            text-align: left;
        }
    </style>
    <?php echo $__env->make('common.ajax_set', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
</head>
<body>
<?php echo $__env->make('layout.auth_header', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<div class="main_1">
    <h2>找回密码</h2>
    <form action="<?php echo e(route('reset_pwd')); ?>" method="get" name="getPassword2" onSubmit="return check_code()" id="form">
        <div class="refer">
            <?php echo csrf_field(); ?>

            <?php /*<label class="input_box fn_clear">*/ ?>
            <?php /*<span class="input_box_before">用户名：</span>*/ ?>
            <?php /*<p>*/ ?>
            <?php /*<input id="user_name" class="username_1" type="text" name=""*/ ?>
            <?php /*value="<?php echo e(old('user_name')); ?>"/>*/ ?>
            <?php /*<span class="prompt">请输入您的用户名！</span>*/ ?>
            <?php /*</p>*/ ?>
            <?php /*</label>*/ ?>
            <label class="input_box fn_clear">
                <span class="input_box_before">手机号：</span>
                <p>
                    <input id="mobile_phone" class="username_1" type="text" name="mobile_phone"
                           value="<?php echo e(old('mobile_phone')); ?>"/>
                    <span class="prompt">请输入您的绑定手机号！</span>
                </p>
            </label>
            <label class="input_box fn_clear">
                <span class="input_box_before">验证码：</span>
                <p style="width: 100px;">
                    <input id="reset_code" style="width: 80px;" class="username_1" type="text" name="code"
                           value="<?php echo e(old('reset_code')); ?>"/>
                    <button id="submit"
                            style="right: -130px;width: 120px;padding: 0 10px;cursor: pointer;
                            border: 1px solid #1d54d0;background: #4478ec;color: white;text-align: center"
                            class="prompt" onclick="sendMessage()" type="button">点击发送验证码
                    </button>
                </p>
            </label>
            <?php /*<label class="input_box email_label fn_clear">*/ ?>
            <?php /*<span class="input_box_before">Email ：</span>*/ ?>
            <?php /*<p>*/ ?>
            <?php /*<span class="ico ico2"></span>*/ ?>
            <?php /*<input class="email_1" type="text" name="email" value="<?php echo e(old('email')); ?>"/>*/ ?>
            <?php /*<span class="prompt margin_problem">请输入您的邮箱地址！</span>*/ ?>
            <?php /*</p>*/ ?>
            <?php /*<div class="cemail">*/ ?>
            <?php /*<ul>*/ ?>
            <?php /*<li>@qq.com</li>*/ ?>
            <?php /*<li>@163.com</li>*/ ?>
            <?php /*<li>@126.com</li>*/ ?>
            <?php /*<li>@sohu.com</li>*/ ?>
            <?php /*<li>@sina.com</li>*/ ?>
            <?php /*<li>@hotmail.com</li>*/ ?>
            <?php /*<li>@gmail.com</li>*/ ?>
            <?php /*<li>@foxmail.com</li>*/ ?>
            <?php /*<li>@139.com</li>*/ ?>
            <?php /*<li>@189.cn</li>*/ ?>
            <?php /*</ul>*/ ?>
            <?php /*</div>*/ ?>
            <?php /*</label>*/ ?>
            <?php /*<span class="tip_txt">注：请输入您正确的用户名，再输入您注册时填写的手机号，点击获取验证码！</span>*/ ?>
            <div class="btn">
                <input type="submit" value="找回密码" class="psw_btn" style="border-radius: 6px;
    background-color: rgb(61, 187, 43);
    width: 110px;
    height: 40px;background-image: none;line-height: 40px;"/>
                <input style="line-height: 40px;color: #666" type="button" value="返回上一页" onclick="history.back()"
                       class="back" name="button">
            </div>
        </div>
    </form>
</div>
<?php echo $__env->make('layout.auth_footer', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<script type="text/javascript">
    var InterValObj;
    var count = 120;
    var curCount;
    function sendMessage() {
        var mobile_phone = $('#mobile_phone').val();
        var user_name = $('#user_name').val();
        if (user_name == '') {
            layer.msg("用户名不能为空", {icon: 2});
            return false;
        }
        if (!(/^1(3|4|5|7|8)\d{9}$/.test(mobile_phone))) {
            layer.msg("手机号码有误，请重填", {icon: 2});
            return false;
        }
        $.ajax({
            url: '/reset_code',
            type: 'post',
            data: {mobile_phone: mobile_phone, user_name: user_name},
            dataType: 'json',
            success: function (data) {
                if (data.error == 0) {
                    curCount = count;

                    $("#submit").css({
                        'border': '1px solid #ccc',
                        'background': '#f5f5f5',
                        'color': '#999'
                    });
                    $("#submit").attr("disabled", "true");
                    $("#submit").text(+curCount + "s后再次发送");
                    InterValObj = window.setInterval(SetRemainTime, 1000);
                } else if (data.error == 2) {
                    curCount = data.s;

                    $("#submit").css({
                        'border': '1px solid #ccc',
                        'background': '#f5f5f5',
                        'color': '#999'
                    });
                    $("#submit").attr("disabled", "true");
                    $("#submit").text(+curCount + "s后再次发送");
                    InterValObj = window.setInterval(SetRemainTime, 1000);
                    data.error = -1;
                }
                layer.msg(data.msg, {icon: data.error + 1})
            }
        })
    }
    function SetRemainTime() {
        if (curCount == 0) {
            window.clearInterval(InterValObj);
            $("#submit").removeAttr("disabled");
            $("#submit").css({
                'border': '1px solid #1d54d0',
                'background': '#4478ec',
                'color': 'white'
            })
            $("#submit").text("点击发送验证码");
        } else {
            curCount--;
            $("#submit").text(+curCount + "s后再次发送");
        }
    }

    function check_code() {
        var mobile_phone = $('#mobile_phone').val();
        var user_name = $('#user_name').val();
        var reset_code = $('#reset_code').val();
        if (user_name == '') {
            layer.msg("用户名不能为空", {icon: 2});
            return false;
        }
        if (!(/^1(3|4|5|7|8)\d{9}$/.test(mobile_phone))) {
            layer.msg("手机号码有误，请重填", {icon: 2});
            return false;
        }
        if (reset_code == '') {
            layer.msg("验证码不能为空", {icon: 2});
            return false;
        }
        var flag = false;
        $.ajax({
            url: '/check_reset_code',
            type: 'post',
            async: false,
            data: {mobile_phone: mobile_phone, user_name: user_name, reset_code: reset_code},
            dataType: 'json',
            success: function (data) {
                if (data.error == 1) {
                    layer.msg(data.msg, {icon: data.error + 1})
                } else {
                    flag = true;
                }
            }
        });
        return flag;
    }
</script>
</body>

</html>
