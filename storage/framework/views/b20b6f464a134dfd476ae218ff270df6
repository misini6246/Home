
<?php $__env->startSection('links'); ?>
    <link href="<?php echo e(path('/css/base.css')); ?>" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="<?php echo e(path('/js/goods_list.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('/js/jquery.lazyload.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('/js/jump.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('/js/index.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('/js/slides.jquery.js')); ?>"></script>
    <script type="text/javascript" src="<?php echo e(path('/js/jquery.cookie.js')); ?>"></script>
    <style type="text/css">
        .ms-left span, .time-item span {
            font-size: 40px;
            color: #fff;
        }

        .time-item strong {
            font-size: 40px;
            color: #bf9104;
            font-weight: normal;
        }

        .list-first {
            width: 1240px;
        }

        .list-first li {
            width: 228px;
            height: 384px;
            float: left;
            margin-right: 10px;
            margin-bottom: 10px;
            background-color: #e0f4fa;
        }

        .list-first li .li-box {
            width: 222px;
            height: 378px;
            border: 3px solid #bf9104;
            background-color: #e0f4fa;
        }

        .list-first li .li-box img {
            width: 222px;
            height: 186px;
        }

        .list-first li .li-box h4 {
            height: 30px;
            line-height: 30px;
            font-weight: normal;
            font-size: 16px;
            color: #03b2d8;
            text-indent: 7px;
        }

        .list-first li .li-box p {
            line-height: 24px;
            color: #040404;
            text-indent: 7px;
            height: 24px;
            overflow: hidden
        }

        .list-first li .li-box .price span {
            color: #eb294e
        }

        .list-first li .li-box .price-txt {
            font-size: 20px;
            font-weight: bold;
        }

        .list-first li .li-box .shopping-btn img {
            width: 206px;
            height: 27px;
        }

        .list-three li {
            width: 228px;
            height: 410px;
            float: left;
            border: 2px solid #b41310;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .list-three li .li-box {
            width: 222px;
            height: 404px;
            border: 3px solid #bf9104;
            background-color: #e0f4fa;
        }

        .list-three li .li-box input {
            width: 45px;
            height: 24px;
            border: 1px solid #dddddd;
            float: left;
            text-align: center;
            border-left: 0;
            border-right: 0;
        }

        .btn {
            height: 32px;
            margin-top: 5px;
        }

        .btn .num {
            width: 27px;
            height: 27px;
            text-align: center;
            line-height: 27px;
            border: 1px solid #dbdbdb;
            float: left;
            margin: 0 3px 0 7px;
        }

        .btn p {
            width: 16px;
            height: 28px !important;
            float: left;
        }

        .btn span {
            display: block;
            width: 16px;
            height: 14px;
            float: left;
            background: url(./images/sprite.png) no-repeat;
            cursor: pointer;
        }

        .btn span.add {
            background-position: -182px 0
        }

        .btn span.reduce {
            background-position: -182px -14px
        }

        .btn a {
            display: block;
            float: left;
            width: 112px;
            height: 26px;
            border: 1px solid #dbdbdb;
            margin-left: 10px;
            line-height: 26px;
            text-indent: 38px;
            background-color: #fff;
            color: #e70000;
            position: relative;
        }

        .btn a em {
            width: 23px;
            height: 26px;
            float: left;
            background: url(./images/com_sprites.png) -71px -1px no-repeat;
            position: absolute;
            left: 10px;
            top: 0;
        }

        body {
            padding: 0 !important;
            margin: 0;
            background-color: #ffc412 !important;
        }
    </style>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>

    <div style='background: url("<?php echo e(get_img_path('images/shang1209.jpg')); ?>") no-repeat scroll center top;height: 460px;min-width: 1200px;overflow: hidden;width: 100%;'>
    </div>
    <div class="site-content-box" style="width: 1200px;margin: 0 auto;">

        <div class="site-first">

            <div class="good-list" style="margin-top: 20px;width: 1200px;overflow: hidden;">
                <div class="title" style="width:290px;height:94px;margin:0 auto 30px auto;"><img
                            src="<?php echo e(get_img_path('images/shang12010.jpg')); ?>" alt=""></div>
                <ul class="list-first fn_clear" style="background-color:#efb505;padding:10px 10px 0 10px">

                    <?php foreach($goods_list as $k=>$v): ?>
                        <li>
                            <div class="li-box">
                                <a href="<?php echo e($v->goods_url); ?>" target="_blank"><img src="<?php echo e($v->goods_thumb); ?>" alt=""/></a>
                                <h4><?php echo e(str_limit($v->goods_name,26)); ?></h4>
                                <p><?php echo e(str_limit($v->sccj,34)); ?></p>
                                <p>规格：<?php echo e($v->spgg); ?></p>
                                <div class="fn_clear" style="height: 24px;line-height: 24px;">
                                    <p style="width: 45%;float: left;">件装量：<?php echo e(isset($v->jzl) ? $v->jzl : ''); ?></p>
                                    <p style="width: 55%;float: left;<?php if($v->is_xq_red==1): ?> color:#e70000; <?php endif; ?>">
                                        效期：<?php echo e($v->xq); ?></p>
                                </div>

                                <div class="price">
                                    <p>
                                        <span style="color:#040404">价格：</span>
                                        <span class="price-txt"><?php echo e($v->real_price_format); ?></span>
                                    </p>

                                </div>
                                <div class="fn_clear" style="height: 24px;line-height: 24px;">
                                    <p style="width: 45%;float: left;">库存：<?php if($v->goods_number>800): ?>
                                            充裕<?php elseif($v->goods_number==0): ?>缺货<?php else: ?><?php echo e($v->goods_number); ?><?php endif; ?> </p>
                                    <p style="width: 55%;float: left;"> 中包装：<?php echo e(isset($v->zbz) ? $v->zbz : 1); ?></p>
                                </div>

                                <div class="btn">
                                    <input class="num ls_num" id="J_dgoods_num_<?php echo e($v->goods_id); ?>" name="number"
                                           type="text" value="<?php if($v->ls_gg>0): ?><?php echo e($v->ls_gg); ?><?php else: ?><?php echo e(isset($v->zbz) ? $v->zbz : 1); ?><?php endif; ?>"
                                           defaultnumber="<?php if($v->ls_gg>0): ?><?php echo e($v->ls_gg); ?><?php else: ?><?php echo e(isset($v->zbz) ? $v->zbz : 1); ?><?php endif; ?>"
                                           onblur="changePrice(<?php echo e($v->goods_id); ?>)" data-zbz="<?php echo e(isset($v->zbz) ? $v->zbz : 1); ?>"
                                           data-lsgg="<?php echo e($v->ls_gg); ?>" data-lsggg="<?php echo e($v->ls_ggg); ?>"
                                           data-xgtype="<?php echo e($v->xg_type); ?>" data-gn="<?php echo e($v->goods_number); ?>"
                                           data-xgtypeflag="<?php echo e($v->xg_type_flag); ?>" dd-id="<?php echo e($k); ?>"/>
                                    <p>
                                        <span class="add" onclick="add_num(<?php echo e($v->goods_id); ?>)"></span>
                                        <span class="reduce" onclick="reduce_num(<?php echo e($v->goods_id); ?>)"></span>
                                    </p>
                                    <input type="hidden" value="<?php echo e($v->goods_id); ?>" id="goods_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e($v->ls_gg); ?>" id="lsgg_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e($v->is_xg); ?>" id="yl_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e($v->xg_num); ?>" id="isYl_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e($v->goods_number); ?>" id="gn_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e(isset($v->zbz) ? $v->zbz : 1); ?>" id="zbz_<?php echo e($v->goods_id); ?>"/>
                                    <input type="hidden" value="<?php echo e(isset($v->jzl) ? $v->jzl : 0); ?>" id="jzl_<?php echo e($v->goods_id); ?>"/>
                                    <a <?php if($v->is_can_see==1): ?>href="javascript:tocart(<?php echo e($v->goods_id); ?>)"
                                       <?php else: ?> href="javascript:addToCart2(<?php echo e($v->goods_id); ?>)"
                                       <?php endif; ?> id="dsssss_<?php echo e($v->goods_id); ?>"><em></em>加入购物车</a>
                                </div>
                            </div>
                        </li>
                    <?php endforeach; ?>
                </ul>


            </div>
        </div>
        <div><img src="<?php echo e(get_img_path('adimages1/201809/erji/xrtj1.jpg')); ?>"></div>
        <div class="bottom-box">
            <div class="l-box" style="width:582px;height:390px;float:left;margin-left:10px;"><a target="_blank"
                                                                                                href="/jifen"><img
                            src="<?php echo e(get_img_path('adimages1/201809/erji/xrtj2.jpg')); ?>" alt=""></a></div>
            <div class="r-box" style="width:582px;height:390px;float:left;margin-left:20px;"><img
                        src="<?php echo e(get_img_path('adimages1/201809/erji/xrtj3.jpg')); ?>" alt=""></div>


        </div>
    </div>
    <div style='background: url("<?php echo e(get_img_path('images/shang12013.jpg')); ?>") no-repeat scroll center top;height: 158px;min-width: 1200px;overflow: hidden;width: 100%;'>
    </div>

    <div class="footer-box" style="width:100%;height:500px;background-color:#2897d0;">
        <div class="footer" style="width:1200px;margin:0 auto;">
            <ul style="width:870px;margin:0 auto" class="cc fn_clear">
                <li><a target="_blank" href="<?php echo e(route('index')); ?>#mzjx"><img
                                src="<?php echo e(get_img_path('images/shang12014.jpg')); ?>" alt=""></a></li>
                <li><a target="_blank" href="/cxhd/czhg"><img src="<?php echo e(get_img_path('images/shang12015.jpg')); ?>"
                                                              alt=""></a></li>
                <li><a target="_blank" href="<?php echo e(isset($mydc) ? $mydc : route('index')); ?>"><img
                                src="<?php echo e(get_img_path('images/shang12016.jpg')); ?>" alt=""></a></li>
            </ul>

            <ul style="width:760px;margin:0 auto" class="sm fn_clear">
                <li><img src="<?php echo e(get_img_path('images/shang12017.jpg')); ?>" alt=""></li>
                <li><img src="<?php echo e(get_img_path('adimages1/201807/erji/shang12018.jpg')); ?>" alt=""></li>

            </ul>

        </div>


    </div>

    <style type="text/css">
        .footer-box ul.cc li {
            width: 200px;
            height: 80px;
            float: left;
            margin: 75px 0 75px 75px;
        }

        .footer-box ul.sm li {
            width: 170px;
            height: 210px;
            float: left;
            margin: 0 0 0px 150px;
            *margin-top: 75px;
        }

    </style>
    <!-- 加入购物车弹出层begin -->
    <div class="comfirm_buy" style="display:none;" id="shopping_box">
        <div class="content_buy"><a href="#" class="success"></a>
            <h4>&nbsp;</h4>
            <p class="tip_txt" alt="" title="">&nbsp;</p>

            <p class="login_p tab_p1" style="display: none;">
                <a class="login_a again">继续购物</a> <a href="<?php echo e(route('cart.index')); ?>">去结算 ></a>
            </p>

            <p class="login_p tab_p2" style="display: none;">
                <a href="/auth/login" class="login_a">登录</a> <a href="/auth/register">注册</a>
            </p>

            <p class="login_p tab_p3" style="display: none;">
                <a href="requirement.php" class="login_a">去登记</a> <a class="login_a again">取消</a>
            </p>

            <p class="login_p tab_p4" style="display: none;">
                <a class="login_a confirm again">确认</a>
            </p>

            <p class="login_p tab_p5" style="display: none;">
                <a href="#" class="login_a confirm">确认</a>
            </p>

            <span class="close2"></span>
        </div>
    </div>
    <!-- 加入购物车弹出层end -->


    <script type="text/javascript">
        function add_num(id) {
            var gn = parseInt($('#gn_' + id).val());
            var yl = parseInt($('#yl_' + id).val());
            var isYl = parseInt($('#isYl_' + id).val());
            var lsgg = parseInt($('#lsgg_' + id).val());
            var zbz = parseInt($('#zbz_' + id).val());
            var jzl = parseInt($('#jzl_' + id).val());
            var num = parseInt($('#J_dgoods_num_' + id).val());
            //console.log(gn,yl,isYl,lsgg,zbz,jzl,num);
            num = num + zbz;
            if (jzl) {//件装量存在
                if ((num % jzl) / jzl >= 0.8) {//购买数量达到件装量80%
                    alert('温馨提示：你所选择的数量已接近件装量，为避免拆零引起的运输破损，系统自动调为整件。')
                    num = Math.ceil(num / jzl) * jzl;
                }
            }

            if (num % zbz != 0) {//不为中包装整数倍
                num = num - num % zbz + zbz;
            }

            if (isYl > 0 && num > isYl && yl == 1) {//商品限购
                num = isYl;
                layer.msg('最大限购数量' + isYl, {icon: 2});
            }

            if (num > gn) {
                alert('库存不足');
                return false;
            }
            $('#J_dgoods_num_' + id).val(num);
        }

        function reduce_num(id) {
            var gn = parseInt($('#gn_' + id).val());
            var yl = parseInt($('#yl_' + id).val());
            var isYl = parseInt($('#isYl_' + id).val());
            var lsgg = parseInt($('#lsgg_' + id).val());
            var zbz = parseInt($('#zbz_' + id).val());
            var jzl = parseInt($('#jzl_' + id).val());
            var num = parseInt($('#J_dgoods_num_' + id).val());
            num = num - zbz;
            if (jzl) {//件装量存在
                if ((num % jzl) / jzl >= 0.8 && (num % jzl) / jzl <= 1) {//购买数量达到件装量80%
                    num = num - num % jzl + parseInt(jzl * 0.8);
                }
            }

            if (num % zbz != 0) {//不为中包装整数倍
                num = num - num % zbz;
            }

            if (isYl > 0 && num > isYl && yl == 1) {//商品限购
                num = isYl;
                layer.msg('最大限购数量' + isYl, {icon: 2});
            }

            if (num < 1) {
                num = zbz;
            }
            $('#J_dgoods_num_' + id).val(num);
        }

        function changePrice(id) {
            var gn = parseInt($('#gn_' + id).val());
            var yl = parseInt($('#yl_' + id).val());
            var isYl = parseInt($('#isYl_' + id).val());
            var lsgg = parseInt($('#lsgg_' + id).val());
            var zbz = parseInt($('#zbz_' + id).val());
            var jzl = parseInt($('#jzl_' + id).val());
            var num = parseInt($('#J_dgoods_num_' + id).val());
            if (num < 0) {
                alert('请输入正确的数量');
                $('#J_dgoods_num_' + id).val(0 - zbz);
                return false;
            }
            var old = num;

            if (num % zbz != 0) {//不为中包装整数倍
                num = num - num % zbz + zbz;
            }

            if (jzl) {//件装量存在
                if ((num % jzl) / jzl >= 0.8 && (num % jzl) / jzl <= 1) {//购买数量达到件装量80%
                    alert('温馨提示：你所选择的数量已接近件装量，为避免拆零引起的运输破损，系统自动调为整件。')
                    num = Math.ceil(num / jzl) * jzl;
//                if(num>gn){
//                    alert('库存不足');
//                    num = old - old%jzl + parseInt(jzl*0.8) - zbz;
//                }
                }
            }

            if (isYl > 0 && num > isYl && yl == 1) {//商品限购
                num = isYl;
                layer.msg('最大限购数量' + isYl, {icon: 2});
            }

            if (num > gn) {
                alert('库存不足');
                $('#J_dgoods_num_' + id).val(zbz);
                return false;
            }
            $('#J_dgoods_num_' + id).val(num);
        }

        function tocart(id) {
            var num = $('#J_dgoods_num_' + id).val();
            $.ajax({
                url: '/gwc',
                data: {id: id, num: num},
                dataType: 'json',
                success: function (data) {
                    if (data.error == 0) {
                        if (data.type == 0) {
                            layer.msg('购物车已有该商品', {icon: 0})
                        } else {
                            layer.confirm(data.msg, {
                                btn: ['继续购物', '去结算'], //按钮
                                icon: 1
                            }, function (index) {
                                layer.close(index);
                            }, function () {
                                location.href = '/cart';
                                return false;
                            });
                        }
                    } else if (data.error == 2) {
                        layer.confirm(data.msg, {
                            btn: ['注册', '登录'], //按钮
                            icon: 2
                        }, function () {
                            location.href = '/auth/register';
                        }, function () {
                            location.href = '/auth/login';
                            return false;
                        });
                    } else {
                        if (data.msg.indexOf('血液制品采购委托书') > 0 || data.msg.indexOf('冷藏药品采购委托书') > 0) {
                            layer.alert(data.msg, {
                                btn: ['下载委托书', '确定'], //按钮
                                icon: 2
                            }, function (index) {
                                location.href = '/uploads/血液制品、冷藏药品采购委托书（二合一）.doc';
                            })
                        } else {
                            layer.alert(data.msg, {icon: 2})
                        }
                    }
                }
            })
        }
    </script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layout.body', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>